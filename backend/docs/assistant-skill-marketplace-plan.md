## 助手与技能资产广场落地计划（草案）

### 1. 背景与目标
- 允许用户自定义助手（系统提示词、模型/参数、依赖技能），并可一键公开到公共广场供他人浏览、复用与二次编辑。
- 同步支持技能（API 调用/工作流/检索链等）的发布与复用，实现“助手引用技能、技能可独立共享”的资产聚合。
- 提供基础的质量与安全护栏：内容审核、敏感信息扫描、调用与健康度监控。

### 2. 范围（MVP 4–6 周）
- 账号与权限：资源可设为私有/公开；公开资源默认可 Fork；作者可下线。
- 资源模型：
  - Assistant：name/description/system_prompt/model/config/tags/skills_refs/visibility/version。
  - Skill：name/description/type(openapi|webhook|workflow|script)/schema/examples/tags/visibility/version。
- 编辑与验证：UI 中可编辑提示词/参数，技能支持示例入参/出参校验；内置 Playground 快速验收。
- 分享与发现：公共列表、搜索、标签筛选、热门/最近排序；详情页展示作者、评分、版本、依赖技能。
- 复用机制：Fork 形成版本树；引用外部技能时以语义化版本锁定。
- 监控与质检：基础调用计数、成功率、延迟；公开前自动做敏感词/密钥扫描。

### 3. 阶段性里程碑
- **M1（周1-2）**：完成资源模型与基础 CRUD API；实现私有/公开权限控制；最小前端创建/浏览/搜索页面。
- **M2（周3-4）**：Playground & 校验流程；Fork/版本锁定；敏感信息与内容安全扫描；调用日志基础表与统计接口。
- **M3（周5-6）**：评分/热门榜单；质检报告（入参校验、超时、鉴权）；资源下线/举报流程；运营仪表盘。
- **M4（后续）**：个性化推荐、自动生成助手/技能、批量导入导出、企业私有域与 RBAC、依赖升级提示。

### 4. 核心设计
- **版本与依赖**：使用语义化版本；依赖解析生成锁定清单，避免上游破坏性变更；支持“升级到最新小版本”提示。
- **执行隔离**：技能执行沙盒化（网络白名单、CPU/Mem/并发配额）；用户密钥以 secret_ref 方式注入，不随公开资源泄露。
- **审核与安全**：自动敏感信息扫描 + 可选人工抽检；违规内容可冻结/下线；记录审核日志。
- **检索与推荐**：全文索引（提示词、描述、标签）；热门度=近期调用量×转化率×评分；后续接入协同过滤做个性化。

### 5. 数据与接口草案
- 表/集合：
  - `assistant`：基础元数据、当前版本号、可见性。
  - `assistant_version`：system_prompt、config、skills_refs、changelog。
  - `skill` / `skill_version`：类型、schema、示例、执行入口、可见性。
  - `rating`、`fork`、`tag`、`audit_log`、`invocation_log`、`usage_metric`。
- 关键接口（REST/GraphQL 均可）：
  - 列表/搜索助手与技能（支持标签、作者、排序）。
  - 创建/更新/发布/下线/ Fork 助手与技能。
  - 版本查看与锁定；依赖解析与升级检查。
  - 调用统计与质检报告获取。

### 6. 前后端实现要点
- 前端：
  - 采用现有 dashboard 框架；新增“资产广场”列表页、资源详情页、创建/编辑表单、Fork 流程、Playground 嵌入。
  - 所有用户可见文案通过 i18n；使用已封装的 SWR Hook 调后端。
- 后端：
  - FastAPI 路由瘦身，业务封装 Service + Repository；统一依赖注入、鉴权、日志打点。
  - 内容安全/敏感词扫描：可先接入现有策略或占位接口，后续替换为正式服务。
  - 调用日志异步写入（Celery/队列），防止阻塞请求链路。

### 7. 风险与缓解
- 资源质量参差：上线前自动质检 + 评分/举报闭环。
- 依赖破坏性更新：强制语义化版本 + 锁定；提供升级提示而非自动升级。
- 敏感信息泄露：secret_ref 注入、扫描校验、禁用明文保存；上传前拦截。
- 滥用与成本：公开调用限频/配额；高风险技能需审核或内测白名单。

### 8. 验收标准（MVP）
- 可创建/编辑/发布/下线助手与技能，支持公开/私有与 Fork。
- 公共广场可搜索并查看详情，支持按热门/最近排序。
- Fork 资源自动生成新版本记录并锁定依赖技能版本。
- 内容安全扫描与基础调用指标可用；敏感信息在发布时被拦截或脱敏。

> 如需细化到表结构或接口清单，可在此文档下继续补充。
